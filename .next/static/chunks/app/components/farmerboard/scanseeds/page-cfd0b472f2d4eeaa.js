(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3071],{13306:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>v});var r=a(95155),n=a(12115),s=a(92809),c=a(76355),i=a(32214),o=a(60902),l=a(91867),d=a(68632),h=a(84355),m=a(84109),u=a(46767),g=a(27809),p=a(60668),x=a(49573),f=a.n(x),S=a(94553),j=a(66877);function v(){let[e,t]=(0,n.useState)(!1),[a,x]=(0,n.useState)(null),[v,b]=(0,n.useState)(null),[N,y]=(0,n.useState)(!1),[_,w]=(0,n.useState)(null),[A,D]=(0,n.useState)(!1),[I,k]=(0,n.useState)(null),[C,M]=(0,n.useState)("idle"),[B,E]=(0,n.useState)(null),[O,P]=(0,n.useState)([]),[T,z]=(0,n.useState)("environment"),R=(0,S.b)(),F=(0,n.useRef)(null);(0,n.useEffect)(()=>(J(),()=>{if(f())try{f().stop()}catch(e){console.error("Error stopping Quagga:",e)}}),[]);let J=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});x(!0);let t=(await navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind);P(t),t.length>0&&E(t[0].deviceId),e.getTracks().forEach(e=>e.stop())}catch(e){console.error("Camera permission error:",e),x(!1),k("Camera access denied. Please grant permission to use the scanner.")}},U=async e=>{D(!0),w(null),k(null);try{let t=await fetch("".concat(p.M,"/get_seed_details?batchName=").concat(encodeURIComponent(e)),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(R)}});if(!t.ok)throw Error("Product not found");let a=await t.json();w(a)}catch(e){console.error("Fetch error:",e),k(e.message||"Failed to fetch product details")}finally{D(!1)}},W=()=>{if(!a)return k("Camera permission not granted");L(!1),y(!0),k(null),M("starting"),setTimeout(()=>{f().init({inputStream:{type:"LiveStream",target:F.current,constraints:{width:640,height:480,facingMode:T}},locator:{patchSize:"medium",halfSample:!0},numOfWorkers:2,frequency:10,decoder:{readers:["code_128_reader","ean_reader","ean_8_reader","code_39_reader","code_39_vin_reader","codabar_reader","upc_reader","upc_e_reader","i2of5_reader"]},locate:!0},e=>{if(e){console.error("Quagga init error:",e),k("Scanner error: "+e),M("error"),y(!1);return}f().start(),M("running"),f().onProcessed(e=>{let t=f().canvas.ctx.overlay,a=f().canvas.dom.overlay;e&&(e.boxes&&(t.clearRect(0,0,parseInt(a.getAttribute("width")),parseInt(a.getAttribute("height"))),e.boxes.filter(t=>t!==e.box).forEach(e=>{f().ImageDebug.drawPath(e,{x:0,y:1},t,{color:"green",lineWidth:2})})),e.box&&f().ImageDebug.drawPath(e.box,{x:0,y:1},t,{color:"#00F",lineWidth:2}),e.codeResult&&e.codeResult.code&&f().ImageDebug.drawPath(e.line,{x:"x",y:"y"},t,{color:"red",lineWidth:3}))}),f().onDetected(e=>{let t=e.codeResult.code;console.log("Detected code:",t),L(),b(t),U(t)})})},300)},L=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];f()&&(f().offDetected(),f().stop()),e&&(y(!1),M("idle"))};return(0,r.jsxs)(s.A,{className:"py-4",children:[(e=>{if(e)return window.location.href="/components/farmerboard/cart"})(e),(0,r.jsx)(c.A,{className:"shadow-sm",children:(0,r.jsxs)(c.A.Body,{children:[(0,r.jsxs)("div",{className:"d-flex align-items-center mb-4",children:[(0,r.jsx)(d.A,{size:24,className:"text-primary me-2"}),(0,r.jsx)("h5",{className:"mb-0",children:"Scan Seed Barcode (Rotate Your Phone For Better Scanning)"})]}),I&&(0,r.jsx)(i.A,{variant:"danger",children:I}),(0,r.jsxs)("div",{className:"d-flex align-items-center justify-content-between mb-3",children:[(0,r.jsxs)("div",{children:[!N&&(0,r.jsxs)(o.A,{onClick:W,variant:"primary",children:[(0,r.jsx)(h.A,{className:"me-2",size:18})," Start Scanning"]}),N&&(0,r.jsxs)(o.A,{onClick:L,variant:"secondary",children:[(0,r.jsx)(m.A,{className:"me-2",size:18})," Stop Scanning"]})]}),(0,r.jsxs)(o.A,{onClick:()=>{z("environment"===T?"user":"environment"),N&&(L(!1),setTimeout(()=>W(),300))},variant:"outline-secondary",title:"environment"===T?"Using back camera (tap to switch)":"Using front camera (tap to switch)",children:[(0,r.jsx)(u.A,{size:18,className:"me-1"}),"environment"===T?"Back":"Front"]})]}),(0,r.jsx)("div",{ref:F,style:{width:"100%",height:"400px",marginTop:"1rem",position:"relative",overflow:"hidden"}}),A&&(0,r.jsxs)("div",{className:"text-center py-4",children:[(0,r.jsx)(l.A,{animation:"border"}),(0,r.jsx)("p",{className:"mt-2",children:"Fetching product details..."})]}),_&&(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("h5",{children:"Seed Details"}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Seed Name:"})," ",_.seedName]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Manufacturer:"})," ",_.seedManufacturer]}),(0,r.jsx)("h6",{className:"mt-3",children:"Batch Info"}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Batch Name:"})," ",_.batchDetail.batchName]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Made At:"})," ",_.batchDetail.batchMadeAt]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Manufactured:"})," ",new Date(_.batchDetail.batchManufactured).toLocaleDateString()]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Status:"})," ",(0,r.jsx)("span",{className:"badge ".concat("active"===_.batchDetail.batchStatus?"bg-success":"bg-secondary"),children:_.batchDetail.batchStatus})]}),(0,r.jsx)("div",{style:{marginTop:"15px"},children:(0,r.jsxs)("button",{className:"btn btn-warning",onClick:()=>{(0,j.B5)(_.batchDetail,()=>{t(!0)})},children:[(0,r.jsx)(g.A,{size:18,className:"me-1"})," Add To Cart "]})})]}),v&&!_&&!A&&(0,r.jsxs)("div",{className:"mt-4 alert alert-warning",children:["No product data found for scanned code: ",v]}),v&&(0,r.jsx)(o.A,{onClick:()=>{b(null),w(null),k(null),M("idle")},className:"mt-3",variant:"outline-primary",children:"Scan Another"})]})})]})}},60668:(e,t,a)=>{"use strict";a.d(t,{M:()=>r});let r="https://seedverify-3.onrender.com"},66877:(e,t,a)=>{"use strict";a.d(t,{Ai:()=>s,B5:()=>r,Xl:()=>n,a_:()=>c});let r=(e,t)=>{let a=[];localStorage.getItem("cart")&&(a=JSON.parse(localStorage.getItem("cart"))),a.push({...e,count:1}),a=Array.from(new Set(a.map(e=>e._id))).map(e=>a.find(t=>t._id===e)),localStorage.setItem("cart",JSON.stringify(a)),t()},n=()=>localStorage.getItem("cart")?JSON.parse(localStorage.getItem("cart")):[],s=e=>{let t=[];localStorage.getItem("cart")&&(t=JSON.parse(localStorage.getItem("cart"))),t=t.filter(t=>t._id!==e),localStorage.setItem("cart",JSON.stringify(t))},c=e=>{localStorage.removeItem("cart"),e()}},91575:(e,t,a)=>{Promise.resolve().then(a.bind(a,13306))},94553:(e,t,a)=>{"use strict";a.d(t,{b:()=>r});let r=()=>localStorage.getItem("usertoken")}},e=>{var t=t=>e(e.s=t);e.O(0,[1450,5634,178,8441,1684,7358],()=>t(91575)),_N_E=e.O()}]);